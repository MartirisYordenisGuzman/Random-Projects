{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/zoila/OneDrive/Escritorio/Today-i-learned/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _classCallCheck from \"C:/Users/zoila/OneDrive/Escritorio/Today-i-learned/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/zoila/OneDrive/Escritorio/Today-i-learned/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { FunctionsClient } from '@supabase/functions-js';\nimport { PostgrestClient } from '@supabase/postgrest-js';\nimport { RealtimeClient } from '@supabase/realtime-js';\nimport { StorageClient as SupabaseStorageClient } from '@supabase/storage-js';\nimport { DEFAULT_HEADERS } from './lib/constants';\nimport { fetchWithAuth } from './lib/fetch';\nimport { stripTrailingSlash, applySettingDefaults } from './lib/helpers';\nimport { SupabaseAuthClient } from './lib/SupabaseAuthClient';\nvar DEFAULT_GLOBAL_OPTIONS = {\n  headers: DEFAULT_HEADERS\n};\nvar DEFAULT_DB_OPTIONS = {\n  schema: 'public'\n};\nvar DEFAULT_AUTH_OPTIONS = {\n  autoRefreshToken: true,\n  persistSession: true,\n  detectSessionInUrl: true\n};\nvar DEFAULT_REALTIME_OPTIONS = {};\n/**\n * Supabase Client.\n *\n * An isomorphic Javascript client for interacting with Postgres.\n */\nvar SupabaseClient = /*#__PURE__*/function () {\n  /**\n   * Create a new client for use in the browser.\n   * @param supabaseUrl The unique Supabase URL which is supplied when you create a new project in your project dashboard.\n   * @param supabaseKey The unique Supabase Key which is supplied when you create a new project in your project dashboard.\n   * @param options.db.schema You can switch in between schemas. The schema needs to be on the list of exposed schemas inside Supabase.\n   * @param options.auth.autoRefreshToken Set to \"true\" if you want to automatically refresh the token before expiring.\n   * @param options.auth.persistSession Set to \"true\" if you want to automatically save the user session into local storage.\n   * @param options.auth.detectSessionInUrl Set to \"true\" if you want to automatically detects OAuth grants in the URL and signs in the user.\n   * @param options.realtime Options passed along to realtime-js constructor.\n   * @param options.global.fetch A custom fetch implementation.\n   * @param options.global.headers Any additional headers to send with each network request.\n   */\n  function SupabaseClient(supabaseUrl, supabaseKey, options) {\n    _classCallCheck(this, SupabaseClient);\n    var _a, _b, _c, _d, _e, _f, _g, _h;\n    this.supabaseUrl = supabaseUrl;\n    this.supabaseKey = supabaseKey;\n    if (!supabaseUrl) throw new Error('supabaseUrl is required.');\n    if (!supabaseKey) throw new Error('supabaseKey is required.');\n    var _supabaseUrl = stripTrailingSlash(supabaseUrl);\n    this.realtimeUrl = \"\".concat(_supabaseUrl, \"/realtime/v1\").replace(/^http/i, 'ws');\n    this.authUrl = \"\".concat(_supabaseUrl, \"/auth/v1\");\n    this.storageUrl = \"\".concat(_supabaseUrl, \"/storage/v1\");\n    var isPlatform = _supabaseUrl.match(/(supabase\\.co)|(supabase\\.in)/);\n    if (isPlatform) {\n      var urlParts = _supabaseUrl.split('.');\n      this.functionsUrl = \"\".concat(urlParts[0], \".functions.\").concat(urlParts[1], \".\").concat(urlParts[2]);\n    } else {\n      this.functionsUrl = \"\".concat(_supabaseUrl, \"/functions/v1\");\n    }\n    // default storage key uses the supabase project ref as a namespace\n    var defaultStorageKey = \"sb-\".concat(new URL(this.authUrl).hostname.split('.')[0], \"-auth-token\");\n    var DEFAULTS = {\n      db: DEFAULT_DB_OPTIONS,\n      realtime: DEFAULT_REALTIME_OPTIONS,\n      auth: Object.assign(Object.assign({}, DEFAULT_AUTH_OPTIONS), {\n        storageKey: defaultStorageKey\n      }),\n      global: DEFAULT_GLOBAL_OPTIONS\n    };\n    var settings = applySettingDefaults(options !== null && options !== void 0 ? options : {}, DEFAULTS);\n    this.storageKey = (_b = (_a = settings.auth) === null || _a === void 0 ? void 0 : _a.storageKey) !== null && _b !== void 0 ? _b : '';\n    this.headers = (_d = (_c = settings.global) === null || _c === void 0 ? void 0 : _c.headers) !== null && _d !== void 0 ? _d : {};\n    this.auth = this._initSupabaseAuthClient((_e = settings.auth) !== null && _e !== void 0 ? _e : {}, this.headers, (_f = settings.global) === null || _f === void 0 ? void 0 : _f.fetch);\n    this.fetch = fetchWithAuth(supabaseKey, this._getAccessToken.bind(this), (_g = settings.global) === null || _g === void 0 ? void 0 : _g.fetch);\n    this.realtime = this._initRealtimeClient(Object.assign({\n      headers: this.headers\n    }, settings.realtime));\n    this.rest = new PostgrestClient(\"\".concat(_supabaseUrl, \"/rest/v1\"), {\n      headers: this.headers,\n      schema: (_h = settings.db) === null || _h === void 0 ? void 0 : _h.schema,\n      fetch: this.fetch\n    });\n    this._listenForAuthEvents();\n  }\n  /**\n   * Supabase Functions allows you to deploy and invoke edge functions.\n   */\n  _createClass(SupabaseClient, [{\n    key: \"functions\",\n    get: function get() {\n      return new FunctionsClient(this.functionsUrl, {\n        headers: this.headers,\n        customFetch: this.fetch\n      });\n    }\n    /**\n     * Supabase Storage allows you to manage user-generated content, such as photos or videos.\n     */\n  }, {\n    key: \"storage\",\n    get: function get() {\n      return new SupabaseStorageClient(this.storageUrl, this.headers, this.fetch);\n    }\n  }, {\n    key: \"from\",\n    value: function from(relation) {\n      return this.rest.from(relation);\n    }\n    /**\n     * Perform a function call.\n     *\n     * @param fn  The function name to call.\n     * @param args  The parameters to pass to the function call.\n     * @param options.head   When set to true, no data will be returned.\n     * @param options.count  Count algorithm to use to count rows in a table.\n     *\n     */\n  }, {\n    key: \"rpc\",\n    value: function rpc(fn) {\n      var args = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var options = arguments.length > 2 ? arguments[2] : undefined;\n      return this.rest.rpc(fn, args, options);\n    }\n    /**\n     * Creates a Realtime channel with Broadcast, Presence, and Postgres Changes.\n     *\n     * @param {string} name - The name of the Realtime channel.\n     * @param {Object} opts - The options to pass to the Realtime channel.\n     *\n     */\n  }, {\n    key: \"channel\",\n    value: function channel(name) {\n      var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n        config: {}\n      };\n      return this.realtime.channel(name, opts);\n    }\n    /**\n     * Returns all Realtime channels.\n     */\n  }, {\n    key: \"getChannels\",\n    value: function getChannels() {\n      return this.realtime.getChannels();\n    }\n    /**\n     * Unsubscribes and removes Realtime channel from Realtime client.\n     *\n     * @param {RealtimeChannel} channel - The name of the Realtime channel.\n     *\n     */\n  }, {\n    key: \"removeChannel\",\n    value: function removeChannel(channel) {\n      return this.realtime.removeChannel(channel);\n    }\n    /**\n     * Unsubscribes and removes all Realtime channels from Realtime client.\n     */\n  }, {\n    key: \"removeAllChannels\",\n    value: function removeAllChannels() {\n      return this.realtime.removeAllChannels();\n    }\n  }, {\n    key: \"_getAccessToken\",\n    value: function _getAccessToken() {\n      var _a, _b;\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var _yield$this$auth$getS, data;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.auth.getSession();\n              case 2:\n                _yield$this$auth$getS = _context.sent;\n                data = _yield$this$auth$getS.data;\n                return _context.abrupt(\"return\", (_b = (_a = data.session) === null || _a === void 0 ? void 0 : _a.access_token) !== null && _b !== void 0 ? _b : null);\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n    }\n  }, {\n    key: \"_initSupabaseAuthClient\",\n    value: function _initSupabaseAuthClient(_ref, headers, fetch) {\n      var autoRefreshToken = _ref.autoRefreshToken,\n        persistSession = _ref.persistSession,\n        detectSessionInUrl = _ref.detectSessionInUrl,\n        storage = _ref.storage,\n        storageKey = _ref.storageKey;\n      var authHeaders = {\n        Authorization: \"Bearer \".concat(this.supabaseKey),\n        apikey: \"\".concat(this.supabaseKey)\n      };\n      return new SupabaseAuthClient({\n        url: this.authUrl,\n        headers: Object.assign(Object.assign({}, authHeaders), headers),\n        storageKey: storageKey,\n        autoRefreshToken: autoRefreshToken,\n        persistSession: persistSession,\n        detectSessionInUrl: detectSessionInUrl,\n        storage: storage,\n        fetch: fetch\n      });\n    }\n  }, {\n    key: \"_initRealtimeClient\",\n    value: function _initRealtimeClient(options) {\n      return new RealtimeClient(this.realtimeUrl, Object.assign(Object.assign({}, options), {\n        params: Object.assign({\n          apikey: this.supabaseKey\n        }, options === null || options === void 0 ? void 0 : options.params)\n      }));\n    }\n  }, {\n    key: \"_listenForAuthEvents\",\n    value: function _listenForAuthEvents() {\n      var _this = this;\n      var data = this.auth.onAuthStateChange(function (event, session) {\n        _this._handleTokenChanged(event, session === null || session === void 0 ? void 0 : session.access_token, 'CLIENT');\n      });\n      return data;\n    }\n  }, {\n    key: \"_handleTokenChanged\",\n    value: function _handleTokenChanged(event, token, source) {\n      if ((event === 'TOKEN_REFRESHED' || event === 'SIGNED_IN') && this.changedAccessToken !== token) {\n        // Token has changed\n        this.realtime.setAuth(token !== null && token !== void 0 ? token : null);\n        this.changedAccessToken = token;\n      } else if (event === 'SIGNED_OUT' || event === 'USER_DELETED') {\n        // Token is removed\n        this.realtime.setAuth(this.supabaseKey);\n        if (source == 'STORAGE') this.auth.signOut();\n      }\n    }\n  }]);\n  return SupabaseClient;\n}();\nexport { SupabaseClient as default };","map":{"version":3,"mappings":"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","names":["FunctionsClient","PostgrestClient","RealtimeClient","StorageClient","SupabaseStorageClient","DEFAULT_HEADERS","fetchWithAuth","stripTrailingSlash","applySettingDefaults","SupabaseAuthClient","DEFAULT_GLOBAL_OPTIONS","headers","DEFAULT_DB_OPTIONS","schema","DEFAULT_AUTH_OPTIONS","autoRefreshToken","persistSession","detectSessionInUrl","DEFAULT_REALTIME_OPTIONS","SupabaseClient","supabaseUrl","supabaseKey","options","Error","_supabaseUrl","realtimeUrl","replace","authUrl","storageUrl","isPlatform","match","urlParts","split","functionsUrl","defaultStorageKey","URL","hostname","DEFAULTS","db","realtime","auth","storageKey","global","settings","_initSupabaseAuthClient","fetch","_getAccessToken","bind","_initRealtimeClient","rest","_listenForAuthEvents","customFetch","relation","from","fn","args","rpc","name","opts","config","channel","getChannels","removeChannel","removeAllChannels","getSession","data","session","access_token","storage","authHeaders","Authorization","apikey","url","params","onAuthStateChange","event","_handleTokenChanged","token","source","changedAccessToken","setAuth","signOut"],"sources":["C:\\Users\\zoila\\OneDrive\\Escritorio\\Today-i-learned\\node_modules\\@supabase\\supabase-js\\src\\SupabaseClient.ts"],"sourcesContent":["import { FunctionsClient } from '@supabase/functions-js'\nimport { AuthChangeEvent } from '@supabase/gotrue-js'\nimport {\n  PostgrestClient,\n  PostgrestFilterBuilder,\n  PostgrestQueryBuilder,\n} from '@supabase/postgrest-js'\nimport {\n  RealtimeChannel,\n  RealtimeChannelOptions,\n  RealtimeClient,\n  RealtimeClientOptions,\n} from '@supabase/realtime-js'\nimport { StorageClient as SupabaseStorageClient } from '@supabase/storage-js'\nimport { DEFAULT_HEADERS } from './lib/constants'\nimport { fetchWithAuth } from './lib/fetch'\nimport { stripTrailingSlash, applySettingDefaults } from './lib/helpers'\nimport { SupabaseAuthClient } from './lib/SupabaseAuthClient'\nimport { Fetch, GenericSchema, SupabaseClientOptions, SupabaseAuthClientOptions } from './lib/types'\n\nconst DEFAULT_GLOBAL_OPTIONS = {\n  headers: DEFAULT_HEADERS,\n}\n\nconst DEFAULT_DB_OPTIONS = {\n  schema: 'public',\n}\n\nconst DEFAULT_AUTH_OPTIONS: SupabaseAuthClientOptions = {\n  autoRefreshToken: true,\n  persistSession: true,\n  detectSessionInUrl: true,\n}\n\nconst DEFAULT_REALTIME_OPTIONS: RealtimeClientOptions = {}\n\n/**\n * Supabase Client.\n *\n * An isomorphic Javascript client for interacting with Postgres.\n */\nexport default class SupabaseClient<\n  Database = any,\n  SchemaName extends string & keyof Database = 'public' extends keyof Database\n    ? 'public'\n    : string & keyof Database,\n  Schema extends GenericSchema = Database[SchemaName] extends GenericSchema\n    ? Database[SchemaName]\n    : any\n> {\n  /**\n   * Supabase Auth allows you to create and manage user sessions for access to data that is secured by access policies.\n   */\n  auth: SupabaseAuthClient\n\n  protected realtimeUrl: string\n  protected authUrl: string\n  protected storageUrl: string\n  protected functionsUrl: string\n  protected realtime: RealtimeClient\n  protected rest: PostgrestClient<Database, SchemaName>\n  protected storageKey: string\n  protected fetch?: Fetch\n  protected changedAccessToken: string | undefined\n\n  protected headers: {\n    [key: string]: string\n  }\n\n  /**\n   * Create a new client for use in the browser.\n   * @param supabaseUrl The unique Supabase URL which is supplied when you create a new project in your project dashboard.\n   * @param supabaseKey The unique Supabase Key which is supplied when you create a new project in your project dashboard.\n   * @param options.db.schema You can switch in between schemas. The schema needs to be on the list of exposed schemas inside Supabase.\n   * @param options.auth.autoRefreshToken Set to \"true\" if you want to automatically refresh the token before expiring.\n   * @param options.auth.persistSession Set to \"true\" if you want to automatically save the user session into local storage.\n   * @param options.auth.detectSessionInUrl Set to \"true\" if you want to automatically detects OAuth grants in the URL and signs in the user.\n   * @param options.realtime Options passed along to realtime-js constructor.\n   * @param options.global.fetch A custom fetch implementation.\n   * @param options.global.headers Any additional headers to send with each network request.\n   */\n  constructor(\n    protected supabaseUrl: string,\n    protected supabaseKey: string,\n    options?: SupabaseClientOptions<SchemaName>\n  ) {\n    if (!supabaseUrl) throw new Error('supabaseUrl is required.')\n    if (!supabaseKey) throw new Error('supabaseKey is required.')\n\n    const _supabaseUrl = stripTrailingSlash(supabaseUrl)\n\n    this.realtimeUrl = `${_supabaseUrl}/realtime/v1`.replace(/^http/i, 'ws')\n    this.authUrl = `${_supabaseUrl}/auth/v1`\n    this.storageUrl = `${_supabaseUrl}/storage/v1`\n\n    const isPlatform = _supabaseUrl.match(/(supabase\\.co)|(supabase\\.in)/)\n    if (isPlatform) {\n      const urlParts = _supabaseUrl.split('.')\n      this.functionsUrl = `${urlParts[0]}.functions.${urlParts[1]}.${urlParts[2]}`\n    } else {\n      this.functionsUrl = `${_supabaseUrl}/functions/v1`\n    }\n    // default storage key uses the supabase project ref as a namespace\n    const defaultStorageKey = `sb-${new URL(this.authUrl).hostname.split('.')[0]}-auth-token`\n    const DEFAULTS = {\n      db: DEFAULT_DB_OPTIONS,\n      realtime: DEFAULT_REALTIME_OPTIONS,\n      auth: { ...DEFAULT_AUTH_OPTIONS, storageKey: defaultStorageKey },\n      global: DEFAULT_GLOBAL_OPTIONS,\n    }\n\n    const settings = applySettingDefaults(options ?? {}, DEFAULTS)\n\n    this.storageKey = settings.auth?.storageKey ?? ''\n    this.headers = settings.global?.headers ?? {}\n\n    this.auth = this._initSupabaseAuthClient(\n      settings.auth ?? {},\n      this.headers,\n      settings.global?.fetch\n    )\n    this.fetch = fetchWithAuth(supabaseKey, this._getAccessToken.bind(this), settings.global?.fetch)\n\n    this.realtime = this._initRealtimeClient({ headers: this.headers, ...settings.realtime })\n    this.rest = new PostgrestClient(`${_supabaseUrl}/rest/v1`, {\n      headers: this.headers,\n      schema: settings.db?.schema,\n      fetch: this.fetch,\n    })\n\n    this._listenForAuthEvents()\n  }\n\n  /**\n   * Supabase Functions allows you to deploy and invoke edge functions.\n   */\n  get functions() {\n    return new FunctionsClient(this.functionsUrl, {\n      headers: this.headers,\n      customFetch: this.fetch,\n    })\n  }\n\n  /**\n   * Supabase Storage allows you to manage user-generated content, such as photos or videos.\n   */\n  get storage() {\n    return new SupabaseStorageClient(this.storageUrl, this.headers, this.fetch)\n  }\n\n  /**\n   * Perform a table operation.\n   *\n   * @param table The table name to operate on.\n   */\n  from<\n    TableName extends string & keyof Schema['Tables'],\n    Table extends Schema['Tables'][TableName]\n  >(relation: TableName): PostgrestQueryBuilder<Schema, Table>\n  from<ViewName extends string & keyof Schema['Views'], View extends Schema['Views'][ViewName]>(\n    relation: ViewName\n  ): PostgrestQueryBuilder<Schema, View>\n  from(relation: string): PostgrestQueryBuilder<Schema, any>\n  from(relation: string): PostgrestQueryBuilder<Schema, any> {\n    return this.rest.from(relation)\n  }\n\n  /**\n   * Perform a function call.\n   *\n   * @param fn  The function name to call.\n   * @param args  The parameters to pass to the function call.\n   * @param options.head   When set to true, no data will be returned.\n   * @param options.count  Count algorithm to use to count rows in a table.\n   *\n   */\n  rpc<\n    FunctionName extends string & keyof Schema['Functions'],\n    Function_ extends Schema['Functions'][FunctionName]\n  >(\n    fn: FunctionName,\n    args: Function_['Args'] = {},\n    options?: {\n      head?: boolean\n      count?: 'exact' | 'planned' | 'estimated'\n    }\n  ): PostgrestFilterBuilder<\n    Schema,\n    Function_['Returns'] extends any[]\n      ? Function_['Returns'][number] extends Record<string, unknown>\n        ? Function_['Returns'][number]\n        : never\n      : never,\n    Function_['Returns']\n  > {\n    return this.rest.rpc(fn, args, options)\n  }\n\n  /**\n   * Creates a Realtime channel with Broadcast, Presence, and Postgres Changes.\n   *\n   * @param {string} name - The name of the Realtime channel.\n   * @param {Object} opts - The options to pass to the Realtime channel.\n   *\n   */\n  channel(name: string, opts: RealtimeChannelOptions = { config: {} }): RealtimeChannel {\n    return this.realtime.channel(name, opts)\n  }\n\n  /**\n   * Returns all Realtime channels.\n   */\n  getChannels(): RealtimeChannel[] {\n    return this.realtime.getChannels()\n  }\n\n  /**\n   * Unsubscribes and removes Realtime channel from Realtime client.\n   *\n   * @param {RealtimeChannel} channel - The name of the Realtime channel.\n   *\n   */\n  removeChannel(channel: RealtimeChannel): Promise<'ok' | 'timed out' | 'error'> {\n    return this.realtime.removeChannel(channel)\n  }\n\n  /**\n   * Unsubscribes and removes all Realtime channels from Realtime client.\n   */\n  removeAllChannels(): Promise<('ok' | 'timed out' | 'error')[]> {\n    return this.realtime.removeAllChannels()\n  }\n\n  private async _getAccessToken() {\n    const { data } = await this.auth.getSession()\n\n    return data.session?.access_token ?? null\n  }\n\n  private _initSupabaseAuthClient(\n    {\n      autoRefreshToken,\n      persistSession,\n      detectSessionInUrl,\n      storage,\n      storageKey,\n    }: SupabaseAuthClientOptions,\n    headers?: Record<string, string>,\n    fetch?: Fetch\n  ) {\n    const authHeaders = {\n      Authorization: `Bearer ${this.supabaseKey}`,\n      apikey: `${this.supabaseKey}`,\n    }\n    return new SupabaseAuthClient({\n      url: this.authUrl,\n      headers: { ...authHeaders, ...headers },\n      storageKey: storageKey,\n      autoRefreshToken,\n      persistSession,\n      detectSessionInUrl,\n      storage,\n      fetch,\n    })\n  }\n\n  private _initRealtimeClient(options: RealtimeClientOptions) {\n    return new RealtimeClient(this.realtimeUrl, {\n      ...options,\n      params: { ...{ apikey: this.supabaseKey }, ...options?.params },\n    })\n  }\n\n  private _listenForAuthEvents() {\n    let data = this.auth.onAuthStateChange((event, session) => {\n      this._handleTokenChanged(event, session?.access_token, 'CLIENT')\n    })\n    return data\n  }\n\n  private _handleTokenChanged(\n    event: AuthChangeEvent,\n    token: string | undefined,\n    source: 'CLIENT' | 'STORAGE'\n  ) {\n    if (\n      (event === 'TOKEN_REFRESHED' || event === 'SIGNED_IN') &&\n      this.changedAccessToken !== token\n    ) {\n      // Token has changed\n      this.realtime.setAuth(token ?? null)\n\n      this.changedAccessToken = token\n    } else if (event === 'SIGNED_OUT' || event === 'USER_DELETED') {\n      // Token is removed\n      this.realtime.setAuth(this.supabaseKey)\n      if (source == 'STORAGE') this.auth.signOut()\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}